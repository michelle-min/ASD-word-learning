<!DOCTYPE html>
<html>
  <head>
    <title> Polysemy Experiment </title>
    <script src="jspsych-6.1.0/jspsych.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-image-keyboard-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-audio-button-response.js"></script>
    <script src="jspsych-6.1.0/plugins/jspsych-fullscreen.js"></script>
    <script src="trial_info.js"></script>
    <link href="jspsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css"></link>
    <style>
      .grid-container {
        display: grid;
        grid-template-columns: 1;
        grid-template-rows: 1;
      }
      .grid-container > div {
        margin: 40px;
      }
    </style>
  </head>
  <body></body>
  <script>

  var timeline = [];

  /* Launch fullscreen mode
  note: this plugin will NOT work for Safari */
  timeline.push({
    type: 'fullscreen',
    fullscreen_mode: true
  });

  /* Welcome page */
  var welcome = {
    type: 'html-keyboard-response',
    stimulus: 'Welcome to this experiment! Press the space bar to continue.'
  };
  timeline.push(welcome);

/* Intro block: */


/* Trial Block */

  /* Shuffle list of distractors (loaded from trial_info.js) */
  var allDistractors = jsPsych.randomization.shuffle(allDistractors);
  var allTargets
  var allAudio

  /* Create timeline variable of target, 3 distractors, and audio for 18
  trials; shuffle choice order within each trial; record info for later.
  note: delete two distractors from loop for a 2-choice experiment */
  var trial_stimuli = [];
  for (i = 0; i < allTargets.length; i++) {
    trialChoices = [allTargets[i], allDistractors[3*i], allDistractors[3*i+1], allDistractors[3*i+2]];
    trialChoices = jsPsych.randomization.shuffle(trialChoices);
    trial_stimuli[i] = {choices: trialChoices, audio: allAudio[i], target: allTargets[i]}, + "\n";
  }

  /* HTML for image buttons */
  var stimButton = '<div class="grid-container"><div><img src="%choice%" width="250" height="250"/></div></div>';

  /* Audio-button trial */
  var trial_audiobutton = {
      type: 'audio-button-response',
      stimulus: jsPsych.timelineVariable('audio'),
      choices: jsPsych.timelineVariable('choices'),
      button_html: stimButton,
      data: {
        choices: jsPsych.timelineVariable('choices'),
        audio: jsPsych.timelineVariable('audio'),
        target: jsPsych.timelineVariable('target'),
        experiment_part: 'trial'
      },
      on_finish: function(data){
        var acc = false;
        var indexNumber = data.button_pressed;
        if (data.target == data.choices[indexNumber]) {
          acc = true
        }
        data.accuracy = acc;
      }
  };

  /* Audio-button trial for fillers
  var filler_audiobutton =
  */

  /* Procedure - intersperse target trials with filler trials */
  var trial_procedure = {
    timeline: [trial_audiobutton],
    timeline_variables: trial_stimuli,
    randomize_order: true
  };
  timeline.push(trial_procedure);

  /* Exit page */


/* Initialize */

  /* Array of paths to all images for preloading */
  var allImages = allDistractors.concat(allTargets);

  jsPsych.init({
    timeline: timeline,
    preload_images: allImages, // preload because timeline variable
    preload_audio: allAudio,
    default_iti: 100, // intertrial interval (ms)
    experiment_width: 750, // max experiment width
    use_webaudio: false, // load audio through HTML5 when running locally
    on_finish: function(){
      jsPsych.data.displayData(); // saved data
    }
    /* excludes browsers that don't have access to WebAudio API
    exclusions: {
      audio: true
    }
    */
  });

  </script>
</html>
